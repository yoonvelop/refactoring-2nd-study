# Chapter 02. 리팩터링 원칙
리팩터링의 의미와 리팩터링 전반에 사용되는 원칙

---

## 2.1 리팩터링 정의

💡 [명사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 **기법**

💡 [동사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.

→ 특정한 방식에 따라 코드를 정리하는 것만이 리팩터링이다.
> 리팩터링하는 동안에는 코드가 항상 정상 작동 하기 때문에 전체 작업이 띁나지 않았더라도 언제든 멈출수 있다. 
> 
> _누군가 "리팩터링하다가 코드가 깨져서 며칠이나 고생했다" 라고 한다면 십중팔구 리팩터링한 것이 아니다._

- 리팩터링 과정에서 발견된 버그는 리팩터링 후에도 그대로 남아있어야 한다.
- 리팩터링(_코드를 이해하고 수정하기 쉽게 만드는 것이 목적_)은 성능 최적화(_속도 개선이 목적_)와 비슷하지만 목적이 다르다.
---
## 2.2 두개의 모자
개발 시 목적에 따라 작업을 명확히 하자.
- 기능 추가: 기존 코드는 절대 건드리지 않고 새기능을 추가하기만 한다.
- 리팩터링: 기능 추가는 절대 하지 않고 오로지 코드 재구성에만 전념한다.
---
## 2.3 리팩터링하는 이유
### (1) 리팩터링하면 소프트웨어 설계가 좋아진다.
- 아키텍처를 이해하지 못한 채 단기 목표만을 위해 코드를 수정하면 기반 구조가 무너지기 쉽다.  
  → 코드만 봐서는 설계 파악이 어려워진다.  
  → 코드 구조가 무너지기 시작하면 악효과가 누적된다.
- **중복 코드 제거**: 코드량이 많다면 실수 없이 수정하기 어렵고 이해햐야할 코드량이 늘어난다.  
  → 중복 코드를 제거하면 모든 코드가 언제나 고유한 일울 수행함을 보장할 수 있다.

### (2) 리팩터링하면 소프트웨어를 이해하기 쉬워진다.
- 리팩터링은 코드가 더 잘 읽히게 도와준다.  
  → 코드의 목적이 잘 드러나게, 기억할 필요가 있는 것들은 _최대한 코드_ 에 담으려고 하자.

### (3) 리팩터링하면 버그를 쉽게 찾을 수 있다.
- 리팩터링하면 코드가 하는 일을 깊게 파악하게 되면서 새로 깨달은 것을 곧바로 코드에 반영하게 된다.  
  → 코드를 이해하기 쉽다는 말은 버그를 찾기 쉽다는 말

### (4) 리팩터링하면 프로그래밍 속도를 높일 수 있다.
- 좋은 설계와 나쁜 설계의 프로그래밍 속도 차이의 이유는 _소프트웨어 내부 품질_ 에 있다.
- **내부 설계**가 잘되어 있다면 새로운 기능을 추가할 지점과 어떻게 고칠지를 쉽게 찾을 수 있다.
- **모듈화**가 잘 되어 있다면 전체 코드베이스 중 작은 일부만 이해하면 된다.
---
## 2.4 언제 리팩터링 해야 할까?
> **3의 법칙** : 비슷한 일을 세 번째 하게 되면 리팩터링 한다. 
### (1) 준비를 위한 리팩터링: 기능을 쉽게 추가
코드베이스에 기능을 새로 추가하기 직전에 하는 리팩터링
- 현재 코드를 살펴보며, 구조만 살짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.
- 예를 들어, 오류를 일으키는 코드가 세 곳에 복제되어 퍼져 있다면, 우선 한 곳으로 합친다.
### (2) 이해를 위한 리팩터링: 코드를 이해하기 쉽게
코드를 수정할 때 하는 리팩터링
- 코드를 파악하면서 코드의 의도가 더 명확하게 드러나도록 리팩터링할 여지는 없는지 찾는다.  
  → _조건부 로직의 구조가 이상하지 않은지, 함수 이름이 명확한지..._
### (3) 쓰레기 줍기 리팩터링
코드를 파악하던 중 비효율적인 부분을 발견 했을 때
- 간단히 수정할수 있는 것은 즉시 고치고, 시간이 걸리는 일은 짧은 메모만 남긴 후 하던 일을 끝내고 나서 처리한다.
### (4) 계획된 리팩터링과 수시로 하는 리팩터링
리팩터링 일정을 따로 잡아두지 않고, 기능을 추가하거나 버그를 잡는 동안 리팩토링도 함께
> 보기 싫은 코드를 발견하면 리팩터링하자. 그런데 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 한다.

> 무언가 수정하려 할때는 먼저 수정하기 쉽게 정돈한 다음 수정하자.
- 새 기능을 추가하기 쉽도록 코드를 '수정' 하는것이 그 기능을 가장 빠르게 추가하는 길일 수 있다.
- 계획된 리팩터링을 하게 되는 일은 최소한으로 줄이고 리팩터링 작업 대부분은 드러나지 않게, 기회가 될 때마다 해야 한다.
### (5) 오래 걸리는 리팩터링
라이브러리를 새 것으로 교체 하거나 쌓여온 의존성을 정리하는 작업
- 팀 전체가 리팩터링에 매달리는 것보다 주어진 문제를 몇 주에 걸쳐 조금씩 해결해가는 편이 효과적 → **점진적으로 다른일과 병행**

### (6) 코드 리뷰에 리팩터링 활용하기
- 코드리뷰는 개발팀 전체에 지식을 전파하는 데 좋다.
- 리팩터링은 다른 이의 코드를 리뷰하는 것과 코드 리뷰의 결과를 더 규체적으로 도출하는 데에 도움이 된다.
- 코드 작성자와 리뷰 참석자가 같이 코드를 보며 리팩터링 하는 방식이 좋다. (pair programming)
### (7) 리팩터링 하지 말아야 할 때
- 굳이 수정할 필요가 없는 경우
- 리팩터링하는 것보다 처음부터 새로 작성하는 게 쉬울 때
---